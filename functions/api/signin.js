export async function onRequest(c){const{request:r,env:e}=c;const h={"Content-Type":"application/json","Access-Control-Allow-Origin":"*"};if(r.method==="OPTIONS")return new Response(null,{status:204,headers:h});try{const{email:m,password:p}=await r.json();if(!e.DB)return new Response(JSON.stringify({error:"DB Missing"}),{status:500,headers:h});const u=await e.DB.prepare("SELECT * FROM users WHERE email=?").bind(m).first();if(!u||u.password!==p)return new Response(JSON.stringify({success:false,error:"Invalid Credentials"}),{status:401,headers:h});const{password:_,...s}=u;return new Response(JSON.stringify({success:true,user:s}),{status:200,headers:h});}catch(err){return new Response(JSON.stringify({error:err.message}),{status:500,headers:h});}}